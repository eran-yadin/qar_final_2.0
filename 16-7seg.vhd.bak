library IEEE;
use IEEE.STD_LOGIC_1164.ALL;

entity hex_to_4x7seg is
    Port ( 
           -- The 16-bit input bus
           data_in : in  STD_LOGIC_VECTOR (15 downto 0);
           
           -- The four 7-segment displays (7 bits each: g, f, e, d, c, b, a)
           seg3    : out STD_LOGIC_VECTOR (6 downto 0); -- Leftmost digit
           seg2    : out STD_LOGIC_VECTOR (6 downto 0);
           seg1    : out STD_LOGIC_VECTOR (6 downto 0);
           seg0    : out STD_LOGIC_VECTOR (6 downto 0)  -- Rightmost digit
         );
end hex_to_4x7seg;

architecture Behavioral of hex_to_4x7seg is

    -- We create a reusable function here so we don't have to write 
    -- the same 7-segment logic four different times.
    function decode_7seg(nibble: STD_LOGIC_VECTOR(3 downto 0)) return STD_LOGIC_VECTOR is
        variable seg : STD_LOGIC_VECTOR(6 downto 0);
    begin
        -- Mapping logic: "gfedcba" (0 = ON, 1 = OFF)
        case nibble is
            when "0000" => seg := "1000000"; -- 0
            when "0001" => seg := "1111001"; -- 1
            when "0010" => seg := "0100100"; -- 2
            when "0011" => seg := "0110000"; -- 3
            when "0100" => seg := "0011001"; -- 4
            when "0101" => seg := "0010010"; -- 5
            when "0110" => seg := "0000010"; -- 6
            when "0111" => seg := "1111000"; -- 7
            when "1000" => seg := "0000000"; -- 8
            when "1001" => seg := "0010000"; -- 9
            when "1010" => seg := "0001000"; -- A
            when "1011" => seg := "0000011"; -- b
            when "1100" => seg := "1000110"; -- C
            when "1101" => seg := "0100001"; -- d
            when "1110" => seg := "0000110"; -- E
            when "1111" => seg := "0001110"; -- F
            when others => seg := "1111111"; -- Blank (All OFF)
        end case;
        return seg;
    end decode_7seg;

begin
    
    -- We split the 16-bit input into four 4-bit chunks (nibbles) 
    -- and feed them into the decoding function above.
    seg3 <= decode_7seg(data_in(15 downto 12));
    seg2 <= decode_7seg(data_in(11 downto 8));
    seg1 <= decode_7seg(data_in(7 downto 4));
    seg0 <= decode_7seg(data_in(3 downto 0));

end Behavioral;